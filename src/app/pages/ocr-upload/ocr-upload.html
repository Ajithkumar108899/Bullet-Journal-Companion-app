<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

<div class="container mt-4">
  <div class="ocr-card">
    <h4 class="fw-bold mb-3">Scan & Image Upload</h4>
    <p class="text-muted">Upload a journal page to extract and process text.</p>

    <!-- Steps Indicator -->
    <div class="d-flex gap-2 mb-3">
      <span class="step-badge" [class.bg-primary]="preview" [class.bg-success]="validated" [class.text-white]="preview">1. Upload</span>
      <span class="step-badge" [class.bg-success]="validated" [class.text-white]="validated">2. Validate</span>
      <span class="step-badge" [class.bg-primary]="scanning" [class.bg-success]="scannedText" [class.text-white]="scanning || scannedText">3. Scan</span>
      <span class="step-badge" [class.bg-success]="scannedText" [class.text-white]="scannedText">4. Complete</span>
    </div>

    <!-- Validation/Error Message -->
    <div *ngIf="errorMsg" class="alert alert-danger mt-3 animated-section">
      <strong>Error:</strong> {{ errorMsg }}
      <div *ngIf="errorMsg.includes('403') || errorMsg.includes('forbidden')" class="mt-2">
        <small>
          <strong>Possible solutions:</strong><br>
          ‚Ä¢ Check if your login session is still valid<br>
          ‚Ä¢ Try logging out and logging in again<br>
          ‚Ä¢ Verify you have permission to access this feature<br>
          ‚Ä¢ Check browser console for more details
        </small>
      </div>
    </div>

    <!-- Upload Zone (hide when preview exists) -->
    <div *ngIf="!preview" class="upload-zone animated-section" (click)="fileInput.click()">
      <p class="fw-semibold mb-1">Click or drop an image</p>
      <small class="text-muted">Max size: 5MB (JPG, PNG, HEIC)</small>
      <input type="file" #fileInput hidden accept="image/*" (change)="onFile($event)" />
    </div>

    <!-- Preview Section -->
    <div *ngIf="preview" class="preview-container animated-section" style="display: block !important; visibility: visible !important;">
      <img [src]="preview" alt="File preview" class="preview-image" style="display: block !important; visibility: visible !important;">
      <p class="preview-text">‚úì Image validated and ready</p>
    </div>

    <!-- Buttons -->
    <div class="mt-3 d-flex flex-wrap gap-2">
      <button class="btn btn-primary" (click)="scan()" [disabled]="!validated || scanning">
        <span *ngIf="!scanning">üîç Start Scan</span>
        <span *ngIf="scanning">‚è≥ Scanning...</span>
      </button>

      <button class="btn btn-outline-danger" (click)="clearAll()">
        ‚úñ Reset
      </button>
    </div>

    <!-- Loading Indicator -->
    <div *ngIf="scanning" class="text-center mt-4 animated-section">
      <div class="loader"></div>
      <p class="text-muted mt-2">Scanning image... Please wait.</p>
    </div>

    <!-- Scanned Output -->
    <div *ngIf="scannedText && !scanning" class="mt-4 animated-section">
      <h6 class="fw-bold mb-2">Extracted Text</h6>
      <div class="text-box">
        {{ scannedText }}
      </div>
    </div>
  </div>
</div>