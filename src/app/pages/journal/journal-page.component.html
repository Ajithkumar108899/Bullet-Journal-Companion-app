<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="form-section shadow-sm mb-4">
  <h4 class="mb-3 fw-bold">{{ editing ? 'Edit Entry' : 'Create New Entry' }}</h4>

  <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
    <div class="row g-3">
      
      <div class="col-md-3">
        <label class="form-label fw-semibold">Type</label>
        <select class="form-select" formControlName="type">
          <option value="task">Task</option>
          <option value="note">Note</option>
          <option value="event">Event</option>
          <option value="habit">Habit</option>
        </select>
      </div>

      <div class="col-md-6">
        <label class="form-label fw-semibold">Title</label>
        <input class="form-control" formControlName="title" placeholder="Enter title">
        <div *ngIf="form.controls['title'].invalid && form.controls['title'].touched" 
             class="text-danger small mt-1">
          Title is required (min 2 characters)
        </div>
      </div>

      <div class="col-md-3">
        <label class="form-label fw-semibold">Date</label>
        <input class="form-control" formControlName="date" type="date">
      </div>
    </div>

    <div class="mt-3">
      <label class="form-label fw-semibold">Notes</label>
      <textarea class="form-control" formControlName="notes" rows="3" placeholder="Additional details..."></textarea>
    </div>

    <div class="mt-3">
      <label class="form-label fw-semibold">Tags</label>
      <input class="form-control" formControlName="tags" placeholder="Comma-separated tags">
    </div>

    <div class="mt-4 d-flex gap-2">
      <button class="btn btn-primary px-4 action-btn" type="submit">
        {{ editing ? 'Save Changes' : 'Add Entry' }}
      </button>

      <button class="btn btn-outline-secondary px-4" type="button" (click)="cancelEdit()" *ngIf="editing">
        Cancel
      </button>
    </div>
  </form>
</div>

<!-- -------------------------------------------- -->
<!-- FILTER BAR -->
<!-- -------------------------------------------- -->
<div class="d-flex align-items-center gap-2 mb-3">
  <label class="form-label fw-semibold mb-0">Filter:</label>
  <select class="form-select w-auto shadow-sm" [(ngModel)]="filter" name="filter">
    <option value="all">All</option>
    <option value="task">Tasks</option>
    <option value="note">Notes</option>
    <option value="event">Events</option>
    <option value="habit">Habits</option>
  </select>
</div>

<!-- -------------------------------------------- -->
<!-- EMPTY STATE -->
<!-- -------------------------------------------- -->
<div *ngIf="filtered().length === 0" class="text-center text-muted py-5">
  <h5>No entries found</h5>
  <p class="small">Try adding a new entry above.</p>
</div>

<!-- -------------------------------------------- -->
<!-- ENTRIES LIST -->
<!-- -------------------------------------------- -->
<div class="row g-4">
  <div class="col-md-6 col-lg-4" *ngFor="let e of filtered()">
    
    <div class="card-modern shadow-sm h-100">
      <div class="d-flex justify-content-between align-items-start mb-2">
        <div>
          <h5 class="mb-1 fw-bold task-title" [class.completed]="e.completed">
            {{ e.title }}
          </h5>
          <span class="text-muted small text-uppercase">{{ e.type }}</span>
        </div>

        <small class="text-muted ms-2">
          {{ e.date || (e.createdAt | slice:0:10) }}
        </small>
      </div>

      <p *ngIf="e.notes" class="text-secondary small mb-2">{{ e.notes }}</p>

      <div *ngIf="e.tags?.length" class="mb-3">
        <span *ngFor="let t of e.tags" class="tag-chip me-1">{{ t }}</span>
      </div>

      <div class="d-flex gap-2 mt-auto">
        <button class="btn btn-sm btn-success action-btn" (click)="toggle(e.id)">
          {{ e.completed ? 'Unmark' : 'Complete' }}
        </button>
        <button class="btn btn-sm btn-outline-primary action-btn" (click)="edit(e)">Edit</button>
        <button class="btn btn-sm btn-outline-danger action-btn" (click)="remove(e.id)">Delete</button>
      </div>
    </div>

  </div>
</div>