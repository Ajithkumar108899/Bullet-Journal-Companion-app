<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<div class="journal-container">
  <!-- Header Section -->
  <div class="journal-header">
    <div class="header-content">
      <h1 class="page-title">My Journal</h1>
      <p class="page-subtitle">Organize your thoughts, tasks, and memories</p>
    </div>
    <button class="btn btn-primary btn-add-entry" (click)="toggleForm()">
      <span class="btn-icon">+</span>
      <span class="btn-text">{{ showForm ? 'Cancel' : 'New Entry' }}</span>
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-section">
    <div class="stat-card stat-total">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-info">
        <div class="stat-value">{{ getStats().total }}</div>
        <div class="stat-label">Total Entries</div>
      </div>
    </div>
    <div class="stat-card stat-task">
      <div class="stat-icon">âœ“</div>
      <div class="stat-info">
        <div class="stat-value">{{ getStats().tasks }}</div>
        <div class="stat-label">Tasks</div>
      </div>
    </div>
    <div class="stat-card stat-note">
      <div class="stat-icon">ğŸ“</div>
      <div class="stat-info">
        <div class="stat-value">{{ getStats().notes }}</div>
        <div class="stat-label">Notes</div>
      </div>
    </div>
    <div class="stat-card stat-event">
      <div class="stat-icon">ğŸ“…</div>
      <div class="stat-info">
        <div class="stat-value">{{ getStats().events }}</div>
        <div class="stat-label">Events</div>
      </div>
    </div>
    <div class="stat-card stat-habit">
      <div class="stat-icon">ğŸ”„</div>
      <div class="stat-info">
        <div class="stat-value">{{ getStats().habits }}</div>
        <div class="stat-label">Habits</div>
      </div>
    </div>
    <div class="stat-card stat-completed">
      <div class="stat-icon">âœ…</div>
      <div class="stat-info">
        <div class="stat-value">{{ getStats().completed }}</div>
        <div class="stat-label">Completed</div>
      </div>
    </div>
  </div>

  <!-- Search and Filter Bar -->
  <div class="search-filter-bar">
    <div class="search-box">
      <span class="search-icon">ğŸ”</span>
      <input 
        type="text" 
        class="search-input" 
        placeholder="Search entries..."
        [(ngModel)]="searchQuery"
        name="search">
      <button 
        *ngIf="searchQuery" 
        class="clear-search" 
        (click)="clearSearch()"
        type="button">
        âœ•
      </button>
    </div>
    <div class="filter-buttons">
      <button 
        class="filter-btn" 
        [class.active]="filter === 'all'"
        (click)="filter = 'all'">
        All
      </button>
      <button 
        class="filter-btn" 
        [class.active]="filter === 'task'"
        (click)="filter = 'task'">
        <span class="filter-icon">âœ“</span> Tasks
      </button>
      <button 
        class="filter-btn" 
        [class.active]="filter === 'note'"
        (click)="filter = 'note'">
        <span class="filter-icon">ğŸ“</span> Notes
      </button>
      <button 
        class="filter-btn" 
        [class.active]="filter === 'event'"
        (click)="filter = 'event'">
        <span class="filter-icon">ğŸ“…</span> Events
      </button>
      <button 
        class="filter-btn" 
        [class.active]="filter === 'habit'"
        (click)="filter = 'habit'">
        <span class="filter-icon">ğŸ”„</span> Habits
      </button>
    </div>
  </div>

  <!-- Entry Form (Collapsible) -->
  <div class="form-section" [class.show]="showForm || editing">
    <div class="form-header">
      <h4 class="form-title">
        <span class="form-icon">{{ editing ? 'âœï¸' : 'â•' }}</span>
        {{ editing ? 'Edit Entry' : 'Create New Entry' }}
      </h4>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit(); showForm = false;" novalidate>
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Entry Type</label>
          <select class="form-select modern-select" formControlName="type">
            <option value="task">âœ“ Task</option>
            <option value="note">ğŸ“ Note</option>
            <option value="event">ğŸ“… Event</option>
            <option value="habit">ğŸ”„ Habit</option>
          </select>
        </div>

        <div class="col-md-6">
          <label class="form-label">Title <span class="required">*</span></label>
          <input 
            class="form-control modern-input" 
            formControlName="title" 
            placeholder="Enter entry title">
          <div *ngIf="form.controls['title'].invalid && form.controls['title'].touched" 
               class="error-message">
            Title is required (min 2 characters)
          </div>
        </div>

        <div class="col-md-3">
          <label class="form-label">Date</label>
          <input 
            class="form-control modern-input" 
            formControlName="date" 
            type="date">
        </div>
      </div>

      <div class="mt-3">
        <label class="form-label">Notes</label>
        <textarea 
          class="form-control modern-input" 
          formControlName="notes" 
          rows="4" 
          placeholder="Add detailed notes or description..."></textarea>
      </div>

      <div class="mt-3">
        <label class="form-label">Tags</label>
        <input 
          class="form-control modern-input" 
          formControlName="tags" 
          placeholder="Enter tags separated by commas (e.g., work, personal, urgent)">
        <small class="form-hint">Separate multiple tags with commas</small>
      </div>

      <div class="form-actions">
        <button class="btn btn-primary btn-submit" type="submit" [disabled]="form.invalid">
          <span *ngIf="!editing">â• Add Entry</span>
          <span *ngIf="editing">ğŸ’¾ Save Changes</span>
        </button>
        <button 
          class="btn btn-outline-secondary btn-cancel" 
          type="button" 
          (click)="cancelEdit()">
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Entries Grid -->
  <div *ngIf="filtered().length > 0" class="entries-grid">
    <div class="entry-card" *ngFor="let e of filtered()" [style.border-left-color]="getEntryTypeColor(e.type)">
      <div class="entry-header">
        <div class="entry-type-badge" [style.background-color]="getEntryTypeColor(e.type)">
          <span class="type-icon">{{ getEntryTypeIcon(e.type) }}</span>
        </div>
        <div class="entry-title-section">
          <h3 class="entry-title" [class.completed]="e.completed">
            {{ e.title }}
          </h3>
          <div class="entry-meta">
            <span class="entry-type">{{ e.type | titlecase }}</span>
            <span class="entry-date">
              ğŸ“… {{ e.date || (e.createdAt | slice:0:10) }}
            </span>
          </div>
        </div>
        <div class="entry-status" *ngIf="e.completed">
          <span class="status-badge completed">âœ“ Completed</span>
        </div>
      </div>

      <div class="entry-body" *ngIf="e.notes">
        <p class="entry-notes">{{ e.notes }}</p>
      </div>

      <div class="entry-tags" *ngIf="e.tags?.length">
        <span *ngFor="let t of e.tags" class="tag-badge">{{ t }}</span>
      </div>

      <div class="entry-actions">
        <button 
          class="action-btn btn-complete" 
          (click)="toggle(e.id)"
          [class.completed]="e.completed">
          <span class="action-icon">{{ e.completed ? 'â†©ï¸' : 'âœ“' }}</span>
          <span class="action-text">{{ e.completed ? 'Undo' : 'Complete' }}</span>
        </button>
        <button class="action-btn btn-edit" (click)="edit(e); showForm = true;">
          <span class="action-icon">âœï¸</span>
          <span class="action-text">Edit</span>
        </button>
        <button class="action-btn btn-delete" (click)="remove(e.id)">
          <span class="action-icon">ğŸ—‘ï¸</span>
          <span class="action-text">Delete</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="filtered().length === 0" class="empty-state">
    <div class="empty-icon">ğŸ“”</div>
    <h3 class="empty-title">
      {{ searchQuery ? 'No entries found' : 'No entries yet' }}
    </h3>
    <p class="empty-message">
      {{ searchQuery ? 'Try adjusting your search or filter' : 'Start by creating your first journal entry!' }}
    </p>
    <button *ngIf="!searchQuery" class="btn btn-primary btn-empty-action" (click)="toggleForm()">
      Create Your First Entry
    </button>
  </div>
</div>